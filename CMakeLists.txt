cmake_minimum_required(VERSION 3.13)
project(legms)

find_package(ZLIB REQUIRED)
find_package(casacore QUIET)

set(MAX_DIM 7 CACHE STRING "Maximum index space dimension")
set(MAX_STRING_SIZE 80 CACHE STRING "Maximum string size")
set(MAX_NUM_KEYWORDS 16 CACHE STRING "Maximum number of table/column keywords")
set(MAX_NUM_TABLE_COLUMNS 35 CACHE STRING "Maximum number of table columns")
set(MAX_NUM_MS_MEASURES 32 CACHE STRING "Maximum number of measures in an MS")
set(BUILD_REGENT ON CACHE BOOL "Build Regent")
set(USE_HDF5 ON CACHE BOOL "Use HDF5")
set(USE_CASACORE ON CACHE BOOL "Use casacore")
set(casacore_ROOT "" CACHE STRING "casacore installation root path")

if (USE_HDF5)
  find_package(HDF5 REQUIRED)
endif ()

if (USE_CASACORE AND casacore_ROOT STREQUAL "")
  message(STATUS "Building casacore within project")
  set(BUILD_CASACORE ON)
else ()
  message(STATUS "Using casacore installation at ${casacore_ROOT}")
  set(BUILD_CASACORE OFF)
  if (USE_CASACORE AND NOT casacore_ROOT STREQUAL "" AND NOT casacore_FOUND)
    message(FATAL_ERROR "USE_CASACORE is ON, yet casacore package was not found at ${casacore_ROOT}")
  endif ()
endif ()

enable_testing()

add_subdirectory(legion)
if (BUILD_REGENT)
  add_subdirectory(terra)
  add_subdirectory(regent)
endif ()
if (BUILD_CASACORE)
  add_subdirectory(casacore)
endif ()
add_subdirectory(legms)
